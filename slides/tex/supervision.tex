\section{Mesure implicite} % (fold)
\label{sec:supervision_active_&_passive}

\begin{frame}{Supervision}

\begin{alertblock}{Objectifs}
  \begin{itemize}
    \item Collecte et interprétation des données
    \item Diagnostic et anticipation de problèmes
  \end{itemize}
\end{alertblock}

  \begin{block}{Exemples}
    \begin{itemize}
      \item Estimer le temps restant avant problème
      \item Anticiper la perte d'un nœud (épuisement batterie)
      \item Suivi de métriques
    \end{itemize}
  \end{block}


\end{frame}

% \begin{frame}{Schéma de supervision}


%   \pnote{
%     - Nombreux produits disponibles dans l'Industrie
%     - Nécessité pour prendre des décisions sur l'état d'un système
%   }
  
% \end{frame}

% \begin{frame}{État de l'art}
%   \begin{block}{Mesure active}
%     \begin{itemize}
%       \item Envoi de statut périodique de la part des nœuds (``health report'', SNMP)
%       \item Sondes tierces
%     \end{itemize}
%   \end{block}

%   \begin{block}{Limitations}
%     \begin{itemize}
%       \item Oblige les nœuds à avoir un agent actif spécifique
%       \item Pour les sondes tierces, elles ont également besoin d’être sondées
%       \item Trafic supplémentaire
%     \end{itemize}
%   \end{block}

%   \pnote{
%     Avec SNMP tu peux avoir un modèle client serveur mais aussi des traps pour l'envoi de notifications.
%   }
%   \pnote{
%     Par contre le protocole SNMP peut être lourd à implémenter (support des MIB Management Information Base pas forcément exhaustif, plusieurs versions du protocole (3 version), dans la troisième qui est sécurisée: pas de négociation de chiffrement =>Doit connaître à l'avance le chiffreur utilisé)
%   }
%   \pnote{
%     - Des nœuds venant de deux vendeurs différents vont pas forcément être supervisés de la même manière
%   }
%   \pnote{
%     - Pas toujours possible de déployer un agent actif sur chaque nœud (plateforme fermée, manque de ressources)
%   }

% \end{frame}

\begin{frame}{Mesure active \& passive}
  \begin{tabular}{|p{0.1\textwidth}|p{0.4\textwidth}|p{0.4\textwidth}|}
   \hline
   & Mesure active &  Mesure passive \\
   \hline
   :-) & \begin{itemize}
     \item Précis
     \item Réactif
   \end{itemize} & \begin{itemize}
     \item Économe
     \item Universel
   \end{itemize} \\
   \hline
   :-( & \begin{itemize}
     \item Consomme
     \item Disponibilité
   \end{itemize} & 
   \begin{itemize}
      \item Imprécis
      \item Non Réactif
    \end{itemize} \\
   \hline
\end{tabular}
\end{frame}

% \begin{frame}{Mesure passive}
%   \begin{block}{Définitions}
%     \begin{itemize}
%       \item Une mesure active nécessite un envoi de paquets dédiés à cette mesure.
%       \item Une mesure passive ne dépend que des paquets qui seraient envoyés de toute façon, même si la mesure n'avait pas lieu.
%     \end{itemize}
%   \end{block}
%   \begin{block}{Propriétés des mesures passives}
%     \begin{itemize}
%       \item Elles sont fondées sur l'observation de paquets non modifiés et non perturbés.
%       \item N'induit aucune consommation de ressources supplémentaires pour les nœuds.
%       \item Elles ne sont donc utiles que s'il existe déjà des paquets intéressants.
%       \item Exemple: sFlow, netflow, IPFIX.
%     \end{itemize}

%   \end{block}

%   \pnote{
%     - Le passif n'en créent pas et n'en modifient pas (rfc 7799)
%   }
% \end{frame}

\begin{frame}\frametitle{Aperçu de la contribution}

  % \begin{block}{Buts}
  %   \begin{itemize}
  %     \item La radio est la principale consommatrice d'énergie
  %     \item Produire une estimation de l'utilisation de la radio
  %     \item Avoir une vue du trafic réseau et identifier les points chauds
  %   \end{itemize}
  % \end{block}

  \begin{figure}
    \centering
    \input{figures/supervision_flow}
  \end{figure}


  \begin{alertblock}{Contribution}
    \begin{itemize}
      % \item Fournir une estimation de l'utilisation de la radio quand la mesure active n'est pas disponible
      \item Estimation de l'utilisation de la radio
      % \item Mesure passive de la consommation énergétique à la passerelle
      \item Topologie réseau connue $\implies$ Déduction coût du relayage
      \item Recalibration
    \end{itemize}
  \end{alertblock}

\end{frame}

% \begin{frame}{Architecture de mesure implicite}
%   % \begin{figure}
%   %   \centering
%   %   \includegraphics[width=\textwidth]{figures/schema_supervision_slides.pdf}
%   % \end{figure}
%   % \begin{block}{TODO: PRINCIPE BIG PICTURE}
%   %   \begin{itemize}
%   %     \item Modélisation de la couche MAC
%   %     \item Maintien de compteurs (tx/rx) pour chaque nœuds
%   %   \end{itemize}
%   % \end{block}
% \end{frame}

\begin{frame}{Estimation du temps radio}

    \begin{block}{Modèle}
      \begin{itemize}
        \item Maintient de compteurs (tx/rx) pour chaque nœud
        % \item Modélisation de la couche MAC
      \end{itemize}
    \end{block}
    
    \begin{columns}
        \begin{column}{0.50\textwidth}

          \begin{figure}
            \centering
            % \includegraphics[width=\textwidth]{figures/schema_supervision_slides.pdf}
            \input{figures/schema_etoile}
            \captionsetup{labelformat=empty}
            \caption{Topologie inconnue}
          \end{figure}

        \end{column}
        \begin{column}{0.50\textwidth}

          \begin{figure}
            \centering
            \input{figures/schema_maille}
            \captionsetup{labelformat=empty}
            \caption{Topologie connue}
          \end{figure}
        \end{column}
    \end{columns}



\end{frame}

% \begin{frame}{Modélisation des transmissions}
%   \begin{figure}
%     \input{figures/impact_transmission}
%   \end{figure}
%   \begin{block}{Estimation ``étoilée'' (Sans connaissance de la topologie)}
%     \begin{itemize}
%       \item Compteurs mis à jour pour la source et la destination (A, B)
%     \end{itemize}
%   \end{block}
%   \begin{block}{Estimation ``maillée'' (Avec connaissance de la topologie)}
%     \begin{itemize}
%       \item Compteurs mis à jour pour la source, destination et routeurs (A, B, R)
%     \end{itemize}
%   \end{block}
%   \pnote{
%     On ignore l'overhearing car le trafic est le plus souvent faible
%   }
%   \pnote{
%     Pas évident d'obtenir le voisinage sans ajout d'informations
%   }
% \end{frame}

\begin{frame}{Modélisation de la couche MAC}
  \begin{block}{Limitations de compteurs naïfs à la couche réseau}
    \begin{itemize}
      \item Ne connaît pas le type de radio utilisé
      \item Ne tient pas compte des retransmissions
    \end{itemize}
  \end{block}
  \begin{block}{Résolution}
    \begin{itemize}
      \item Modélisation en fonction d'une couche MAC donnée
      \item Modélisation linéaire en fonction de la taille de la trame
    \end{itemize}
  \end{block}
  \begin{alertblock}{Calibration préalable}
    \begin{itemize}
      \item Expérience modèle ne mettant en jeu que cette couche MAC
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Strobing moyen $N_{\textrm{sender}}$ (ContikiMAC)}
  \begin{block}{Conditions expérimentales}
      \begin{itemize}
        \item Trafic 1 paquet/s
      \end{itemize}
  \end{block}
  \begin{block}{Topologie}
    \begin{figure}
      \centering
      \input{figures/topologie_binaire}
    \end{figure}
  \end{block}
  \begin{figure}
    \includegraphics<1>[width=.7\textwidth]{figures/new_average_strobing.pdf}
    \includegraphics<2>[width=.7\textwidth]{figures/new_average_strobing_hl.pdf}
  \end{figure}
  % \begin{block}{Calibration}
  %   \begin{itemize}
  %     \item $N_{sender}(69) \approx 3.76$
  %     \item $N_{\textrm{receiver}} = 1.5$ ($\forall$ taille de la trame)
  %   \end{itemize}
  % \end{block}
  \pnote{
    - Une trame longue est détectée plus facilement car elle a plus de chance de tomber entre deux réveils d'un destinataire
  }
\end{frame}

\begin{frame}{Validation expérimentale}
  \begin{block}{Setup}
    \begin{itemize}
      \item Contiki/COOJA/Powertracker
      \item 200 secondes
      \item 1 paquet/s (69 octets sur le médium)
      \item $N_{\textrm{sender}} = 3.76$
    \end{itemize}
  \end{block}
  \begin{figure}
    \centering
    \input{figures/topologie_chaine}
  \end{figure}
  \begin{alertblock}{Objectifs}
    \begin{itemize}
      \item Valider la modélisation du strobing
      \item Évaluer l'impact de la connaissance de la topologie
    \end{itemize}
  \end{alertblock}

  \pnote{
    Choix de la chaîne: Interprétation facile des résultats de topologie par rapport à une topologie quelconque.
  }
  \pnote{
    Route montante = route descendante (Hypothèse simplificatrice)
  }
\end{frame}

% \begin{frame}{Analyse des protocoles}
%     \begin{figure}
%     \centering
%     \captionsetup{labelformat=empty}

%     \subfloat[Répartition par profondeur]{
%         \includegraphics[width=0.5\textwidth]{figures/new_protocol_repartition_depth.pdf}}
%     \subfloat[Évolution au cours du temps]{
%         \includegraphics[width=0.5\textwidth]{figures/new_repartition_protocol.pdf}}
%     \end{figure}
%     \begin{block}{Observations}
%       \begin{itemize}
%         \item L'impact de RPL est homogène par profondeur
%         \item L'impact de RPL diminue au cours du temps
%         \item Le trafic applicatif est globalement majoritaire
%       \end{itemize}
%     \end{block}
%     \pnote{
%       Cependant il faut indiquer que comme on ne prends pas en compte le protocole de routage
%       on va prendre un retard.
%     }
% \end{frame}

\begin{frame}{Évaluation par protocole}

    \begin{columns}
        \begin{column}{0.48\textwidth}
          \begin{figure}
            \centering
            \includegraphics<1>[width=\textwidth]{figures/new_protocol_repartition_depth.pdf}
            \includegraphics<2>[width=\textwidth]{figures/new_protocol_repartition_depth_hl.pdf}
            \captionsetup{labelformat=empty}
            \caption{Répartition par profondeur}
          \end{figure}
        \end{column}
        \begin{column}{0.50\textwidth}
          \begin{figure}
            \centering
            \includegraphics<1>[width=\textwidth]{figures/new_repartition_protocol.pdf}
            \includegraphics<2>[width=\textwidth]{figures/new_repartition_protocol_hl.pdf}
            \captionsetup{labelformat=empty}
            \caption{Évolution au cours du temps}
          \end{figure}

        \end{column}
    \end{columns}

    \begin{block}{Observations}
      \begin{itemize}
        \item L'impact de RPL est homogène par profondeur
        \item L'impact de RPL diminue au cours du temps
        \item Le trafic applicatif est globalement majoritaire
      \end{itemize}
    \end{block}
    \pnote{
      Cependant il faut indiquer que comme on ne prends pas en compte le protocole de routage
      on va prendre un retard.
    }
\end{frame}



\begin{frame}{Validation de $N_{sender}$}
    \begin{figure}
    \centering
    \includegraphics<1>[width=.75\textwidth]{figures/new_stobes_depth.pdf}
    \includegraphics<2>[width=.75\textwidth]{figures/new_stobes_depth_hl.pdf}
    \end{figure}
    \begin{alertblock}{Observations}
      \begin{itemize}
        \item La racine est toujours allumée $\to$ $N_{sender} = 1$ pour le nœud 1.
        \item La valeur de $N_{sender}$ est validée pour les nœuds relais.
        % \item Perte en rafale occasionnelle pour le nœud 6.
      \end{itemize}
    \end{alertblock}
\end{frame}

\begin{frame}{$\delta$ par profondeur}
    \begin{block}{Précision}
      $$\delta = \frac{\widehat{X}}{X}$$
    \end{block}

    \begin{columns}
        \begin{column}{0.48\textwidth}
          \begin{figure}
            \centering
            \includegraphics[width=\textwidth]{figures/global_noinfo.pdf}
            \captionsetup{labelformat=empty}
            \caption{Topologie inconnue}
          \end{figure}
        \end{column}
        \begin{column}{0.50\textwidth}
          \begin{figure}
            \centering
            \includegraphics[width=\textwidth]{figures/global_route.pdf}
            \captionsetup{labelformat=empty}
            \caption{Topologie connue}
          \end{figure}

        \end{column}
    \end{columns}


  \pnote{
    - Remarque de Nathalie: On néglige les ACK. Notre modèle est perfectible.
    Cependant les ack prennent peu de temps à transmettre et ne suffirai probablement pas à rattraper le retard.
  }
  \pnote{
    On ne tient pas compte du protocole de routage au démarrage ainsi on prends du retard.
    Cependant ça s'améliore au cours du temps faire un hameçon pour les questions et montrer le détail après dans les annexes.
  }

\end{frame}

\begin{frame}{Mesure active périodique}
  
  \begin{columns}
      \begin{column}{0.48\textwidth}
        \begin{figure}
          \centering
          \includegraphics[width=0.9\textwidth]{figures/topology_tree.png}
        \end{figure}
      \end{column}
      \begin{column}{0.50\textwidth}
        \begin{figure}
          \centering
          \includegraphics[width=\textwidth]{figures/alpha_ewma.pdf}
        \end{figure}

      \end{column}
  \end{columns}


  % \begin{alertblock}{Modèle correctif: }
  %   \begin{align}
  %     \widehat{X}(t) &= X(t_r) + \epsilon(t_r)\frac{t - t_r}{T}\\
  %     \epsilon(t_r) &= \alpha (X(t_r) - \widehat{X}(t_r)) + (1 - \alpha)\epsilon(t_{r-1})
  %     \label{supervision:eqn:bias}
  %   \end{align}
  % \end{alertblock}
  \begin{block}{Mécanismes de correction}
    \begin{itemize}
      % \item 21 nœuds
      \item Moyenne pondérée (EWMA) $\alpha = 0.25$
      \item Mesure active toutes les 25 secondes
    \end{itemize}
  \end{block}
  \pnote{
    Meme condition de trafic - Cooja/powertracker - 200 secondes
  }
  \pnote{
    alpha faible va privilégier les tendances de fond
  }
\end{frame}

\begin{frame}\frametitle{Évolution de l'erreur d'estimation globale}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{figures/mesure_active.pdf}
  \end{figure}
\end{frame}


% \begin{frame}\frametitle{Bilan}


%   \pnote{
%     - La supervision passive bien qu'imprécise fournit une quantité minimale d'information
%   }
%   \pnote{
%     - La fiabilité des couches basses est essentielle pour construire des modèles fiables
%   }

% \end{frame}
